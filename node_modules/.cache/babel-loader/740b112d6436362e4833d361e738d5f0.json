{"ast":null,"code":"import api from '@/api/report';\nimport apiWagon from '@/api/wagonPark';\nimport { mapState } from 'vuex';\nimport Notifications from '@/components/notifications/Notifications.vue';\nimport Loader from '@/components/loader/loader.vue';\nimport FilterReportAbandon from '@/components/filter/FilterReportAbandon.vue';\nexport default {\n  name: 'ReportAbandoned',\n  components: {\n    Notifications,\n    Loader,\n    FilterReportAbandon\n  },\n\n  data() {\n    return {\n      report_abandoned: '',\n      loader: false,\n      showNotify: false,\n      notifyHead: '',\n      notifyMessage: '',\n      notifyClass: '',\n      total_objects: '',\n      total_objects_report: '',\n      throwWagons: [],\n      filter_FilterReportAbandon: {},\n      filter: {\n        current_station_arrival_begin: '',\n        current_station_arrival_end: ''\n      },\n      format: ''\n    };\n  },\n\n  methods: {\n    showModal() {\n      this.$refs['ModalTypeReport'].show();\n    },\n\n    hideModal() {\n      this.$refs['ModalTypeReport'].hide();\n    },\n\n    toggleModal() {\n      // We pass the ID of the button that we want to return focus to\n      // when the modal has hidden\n      this.$refs['ModalTypeReport'].toggle('#toggle-btn');\n    },\n\n    CreateReportAbandones() {\n      this.loader = true;\n      api.getFilterWafonAbadone(this.format, this.filter).then(response => {\n        this.loader = false;\n        this.DownloadReportAbandones(); // this.report_abandoned = response.data.data\n\n        this.notifyHead = 'Успешно';\n        this.notifyMessage = 'Отчет создан';\n        this.notifyClass = 'wrapper-success';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n        this.hideModal();\n      }).catch(error => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Нет данных для отчета';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      });\n    },\n\n    DownloadReportAbandones() {\n      this.loader = true;\n      api.GetReportAbandone().then(response => {\n        this.report_abandoned = response.data.data;\n        this.total_objects_report = response.data.total_objects;\n        this.loader = false;\n        this.notifyHead = 'Успешно';\n        this.notifyMessage = 'Отчеты загружены';\n        this.notifyClass = 'wrapper-success';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      }).catch(error => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Отчеты не получены';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      });\n    },\n\n    ThrowWagons(url = null, clear = true) {\n      if (url == null) url = 'wagon-park/dislocations?operation=БРОС';\n      if (clear) this.throwWagons = [];\n      this.loader = true;\n      apiWagon.getWagonsThrow(url, this.filter) //this.filter_abadon)\n      .then(response => {\n        this.throwWagons = [...this.throwWagons, ...response.data.data];\n\n        if (response.data.links.next != null) {\n          this.ThrowWagons(response.data.links.next, false);\n          this.loader = false;\n          this.total_objects = response.data.total_objects;\n        } else {\n          this.loader = false;\n          this.total_objects = response.data.total_objects; // this.throwWagons = response.data.data\n          // this.notifyHead = 'Успешно'\n          // this.notifyMessage = 'Данные отфильтрованы'\n          // this.notifyClass = 'wrapper-success'\n          // this.showNotify = true\n          // setTimeout(this.closeNotification, 1500)\n        }\n      }).catch(error => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Данные не получены';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500); // console.log(error.response); вывод ошибок получаемых от сервера\n      });\n    },\n\n    DeleteReportAbandoned(id) {\n      this.loader = true;\n      api.deleteReportAbandon(id).then(response => {\n        this.loader = false;\n        this.notifyHead = 'Успешно';\n        this.notifyMessage = 'Отчет удален';\n        this.notifyClass = 'wrapper-success';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n        this.DownloadReportAbandones();\n      }).catch(error => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Отчет не удален';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      });\n    },\n\n    updateFilter(filter) {\n      this.filter = filter;\n    },\n\n    closeNotification() {\n      this.showNotify = false;\n    }\n\n  },\n  computed: { ...mapState({\n      user: state => state.auth.user,\n      uid: state => state.auth.uid\n    })\n  }\n};","map":{"version":3,"mappings":"AA8KA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA,uBADA;EAEAC;IAAAC;IAAAC;IAAAC;EAAA,CAFA;;EAGAC;IACA;MACAC,oBADA;MAEAC,aAFA;MAIAC,iBAJA;MAKAC,cALA;MAMAC,iBANA;MAOAC,eAPA;MAQAC,iBARA;MASAC,wBATA;MAWAC,eAXA;MAYAC,8BAZA;MAeAC;QACAC,iCADA;QAEAC;MAFA,CAfA;MAmBAC;IAnBA;EAuBA,CA3BA;;EA4BAC;IACAC;MACA;IACA,CAHA;;IAIAC;MACA;IACA,CANA;;IAOAC;MACA;MACA;MACA;IACA,CAXA;;IAYAC;MACA;MACAC,oDACAC,IADA,CACAC;QACA;QACA,+BAFA,CAGA;;QACA;QACA;QACA;QACA;QACAC;QACA;MACA,CAXA,EAWAC,KAXA,CAWAC;QACA;QACA;QACA;QACA;QACA;QACAF;MACA,CAlBA;IAoBA,CAlCA;;IAmCAG;MACA;MACAN,wBACAC,IADA,CACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACAC;MACA,CAVA,EAUAC,KAVA,CAUAC;QACA;QACA;QACA;QACA;QACA;QACAF;MACA,CAjBA;IAkBA,CAvDA;;IAyDAI;MACA;MACA;MAEA;MAEAC;MAAA,CACAP,IADA,CACAC;QACA;;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACA;UACA,iDAFA,CAIA;UACA;UACA;UACA;UACA;UACA;QACA;MACA,CAlBA,EAkBAE,KAlBA,CAkBAC;QACA;QACA;QACA;QACA;QACA;QACAF,yCANA,CAOA;MAEA,CA3BA;IA4BA,CA3FA;;IA4FAM;MACA;MACAT,4BACAC,IADA,CACAC;QACA;QACA;QACA;QACA;QACA;QACAC;QACA;MACA,CATA,EASAC,KATA,CASAC;QACA;QACA;QACA;QACA;QACA;QACAF;MACA,CAhBA;IAiBA,CA/GA;;IAgHAO;MACA;IACA,CAlHA;;IAmHAC;MACA;IACA;;EArHA,CA5BA;EAmJAC,YACA;MACAC,8BADA;MAEAC;IAFA;EADA;AAnJA","names":["name","components","Notifications","Loader","FilterReportAbandon","data","report_abandoned","loader","showNotify","notifyHead","notifyMessage","notifyClass","total_objects","total_objects_report","throwWagons","filter_FilterReportAbandon","filter","current_station_arrival_begin","current_station_arrival_end","format","methods","showModal","hideModal","toggleModal","CreateReportAbandones","api","then","response","setTimeout","catch","error","DownloadReportAbandones","ThrowWagons","apiWagon","DeleteReportAbandoned","updateFilter","closeNotification","computed","user","uid"],"sourceRoot":"src/components/Table","sources":["ReportAbandoned.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <h2>Брошенные вагоны</h2>\r\n        <br><br>\r\n        <Loader :loader=\"loader\"></Loader>\r\n        <FilterReportAbandon @update-filter=\"updateFilter\"></FilterReportAbandon>\r\n\r\n\r\n        <b-modal ref=\"ModalTypeReport\" hide-footer title=\"Выберите тип создаваемого отчета\" id=\"modal-lg\" size=\"lg\">\r\n            <select name=\"\" id=\"\" v-model=\"format\" style=\"margin: 5% 0\">\r\n                <option disabled>Выберите тип создаваемого отчета</option>\r\n                <option value=\"classic\">Стандартный</option>\r\n                <option value=\"disp\">Диспетчерский</option>\r\n                <option value=\"legal\">Юридический</option>\r\n                <br>\r\n\r\n            </select>\r\n            <b-row>\r\n                <b-col></b-col>\r\n                <b-col></b-col>\r\n\r\n            </b-row>\r\n            <input type=\"date\" v-model=\"filter.current_station_arrival_end\">\r\n            <b-button class=\"mt-2\" variant=\"success\" block @click=\"CreateReportAbandones\">Создать отчет\r\n            </b-button>\r\n            <b-button class=\"mt-3\" variant=\"outline-danger\" block @click=\"hideModal\">Закрыть</b-button>\r\n\r\n        </b-modal>\r\n\r\n\r\n        <button class=\"button Action\"\r\n            style=\"width: 100%; position: relative; left: 50%; transform: translate(-50%,0); font-size: 17px; margin: 2% 0 1%\"\r\n            @click=\"ThrowWagons()\">Предварительный запрос вагонов</button>\r\n        <p class=\"amount\">всего записей: {{ total_objects }}</p>\r\n        <div style=\"width: 100%; overflow-x: auto; height: 40vh; overflow-y: auto;\">\r\n            <table class=\"table\" style=\"table-layout: fixed;\">\r\n                <thead>\r\n                    <tr>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Тип вагона</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Номер вагона</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Полигон обращения</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Государство</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Код причины бросания</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Причина бросания</th>\r\n                        <th\r\n                            style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Собственник</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr v-for=\"broc in throwWagons\" :key=\"broc.id\">\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\" v-if=\"broc != null\">\r\n                            {{ broc.wagon_type }}</td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\" v-if=\"broc != null\">\r\n                            {{ broc.wagon }}</td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                            {{ broc.polygon }}</td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                            {{ broc.current_country }}</td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\"\r\n                            v-if=\"broc.drop != null\">\r\n                            {{ broc.drop }}</td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\" v-else>—</td>\r\n\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\"\r\n                            v-if=\"broc.drop != null\">\r\n                            <textarea name=\"\" id=\"\" cols=\"20\" rows=\"1\" :value=\"broc.drop_reason\"></textarea>\r\n                        </td>\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\" v-else>—</td>\r\n\r\n                        <td style=\"height: 50px !important; vertical-align: middle !important;\" v-if=\"broc != null\">\r\n                            {{ broc.wagon_owner }}</td>\r\n\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n\r\n        <b-container class=\"bv-example-row\">\r\n            <b-row>\r\n                <b-col>\r\n                    <b-button class=\"button Action\" @click=\"showModal()\"\r\n                        style=\"background: #ED925E; border: none; font-weight: 500; width: 100%; position: relative; left: 50%; transform: translate(-50%,0); font-size: 17px; margin-top: 3%\">\r\n                        Создать\r\n                        отчет</b-button>\r\n\r\n                </b-col>\r\n\r\n                <b-col>\r\n                    <button class=\"button Action\" @click=\"DownloadReportAbandones()\"\r\n                        style=\"width: 100%; position: relative; left: 50%; transform: translate(-50%,0); font-size: 17px; margin-top: 3%\">Загрузить\r\n                        отчеты</button>\r\n\r\n                </b-col>\r\n            </b-row>\r\n\r\n        </b-container>\r\n        <br><br>\r\n        <p class=\"amount\">всего отчетов: {{ total_objects_report }}</p>\r\n        <b-container class=\"bv-example-row\">\r\n            <b-row>\r\n                <b-col>\r\n                    <div style=\"width: 100%; overflow-x: auto; height: 80vh; overflow-y: auto;\">\r\n                        <table class=\"table\" style=\"table-layout: fixed;\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th\r\n                                        style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Файл</th>\r\n                                    <th\r\n                                        style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Дата создания</th>\r\n                                    <th\r\n                                        style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Создатель</th>\r\n                                    <th\r\n                                        style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Тип вагона</th>\r\n                                    <th\r\n                                        style=\"width: 150px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Действие</th>\r\n\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr v-for=\"reports in report_abandoned\" :key=\"reports.id\">\r\n                                    <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                                        <a download target=\"_blank\" :href=\"reports.file\" v-if=\"reports.file\"><img\r\n                                                src=\"@/assets/excel.png\" alt=\"\" width=\"50px !important\"></a>\r\n                                    </td>\r\n                                    <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                                        {{ new Date(reports.created_at).toLocaleString() }}</td>\r\n                                    <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                                        {{ reports.creator.last_name }} {{ reports.creator.first_name }}</td>\r\n                                    <td style=\"height: 50px !important; vertical-align: middle !important;\">{{\r\n                                            reports.wagon_type\r\n                                    }}\r\n                                    </td>\r\n                                    <td style=\"height: 50px !important; vertical-align: middle !important;\">\r\n                                        <button class=\"Delete\"\r\n                                            @click=\"DeleteReportAbandoned(reports.id)\">Удалить</button>\r\n                                    </td>\r\n\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </b-col>\r\n            </b-row>\r\n        </b-container>\r\n\r\n        <Notifications :show=\"showNotify\" :header=\"notifyHead\" :message=\"notifyMessage\" :block-class=\"notifyClass\"\r\n            id=\"notif\" />\r\n\r\n    </div>\r\n</template>\r\n\r\n<style>\r\n\r\n</style>\r\n\r\n<script>\r\nimport api from '@/api/report'\r\nimport apiWagon from '@/api/wagonPark'\r\nimport { mapState } from 'vuex'\r\nimport Notifications from '@/components/notifications/Notifications.vue'\r\nimport Loader from '@/components/loader/loader.vue'\r\nimport FilterReportAbandon from '@/components/filter/FilterReportAbandon.vue'\r\nexport default {\r\n    name: 'ReportAbandoned',\r\n    components: { Notifications, Loader, FilterReportAbandon },\r\n    data() {\r\n        return {\r\n            report_abandoned: '',\r\n            loader: false,\r\n\r\n            showNotify: false,\r\n            notifyHead: '',\r\n            notifyMessage: '',\r\n            notifyClass: '',\r\n            total_objects: '',\r\n            total_objects_report: '',\r\n\r\n            throwWagons: [],\r\n            filter_FilterReportAbandon: {\r\n\r\n            },\r\n            filter: {\r\n                current_station_arrival_begin: '',\r\n                current_station_arrival_end: ''\r\n            },\r\n            format: '',\r\n\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        showModal() {\r\n            this.$refs['ModalTypeReport'].show()\r\n        },\r\n        hideModal() {\r\n            this.$refs['ModalTypeReport'].hide()\r\n        },\r\n        toggleModal() {\r\n            // We pass the ID of the button that we want to return focus to\r\n            // when the modal has hidden\r\n            this.$refs['ModalTypeReport'].toggle('#toggle-btn')\r\n        },\r\n        CreateReportAbandones() {\r\n            this.loader = true\r\n            api.getFilterWafonAbadone(this.format, this.filter )\r\n                .then((response) => {\r\n                    this.loader = false\r\n                    this.DownloadReportAbandones()\r\n                    // this.report_abandoned = response.data.data\r\n                    this.notifyHead = 'Успешно'\r\n                    this.notifyMessage = 'Отчет создан'\r\n                    this.notifyClass = 'wrapper-success'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                    this.hideModal()\r\n                }).catch(error => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Нет данных для отчета'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                })\r\n\r\n        },\r\n        DownloadReportAbandones() {\r\n            this.loader = true\r\n            api.GetReportAbandone()\r\n                .then((response) => {\r\n                    this.report_abandoned = response.data.data\r\n                    this.total_objects_report = response.data.total_objects\r\n                    this.loader = false\r\n                    this.notifyHead = 'Успешно'\r\n                    this.notifyMessage = 'Отчеты загружены'\r\n                    this.notifyClass = 'wrapper-success'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                }).catch(error => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Отчеты не получены'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                })\r\n        },\r\n\r\n        ThrowWagons(url = null, clear = true) {\r\n            if (url == null) url = 'wagon-park/dislocations?operation=БРОС'\r\n            if (clear) this.throwWagons = []\r\n\r\n            this.loader = true\r\n\r\n            apiWagon.getWagonsThrow(url, this.filter) //this.filter_abadon)\r\n                .then(response => {\r\n                    this.throwWagons = [...this.throwWagons, ...response.data.data]\r\n                    if (response.data.links.next != null) {\r\n                        this.ThrowWagons(response.data.links.next, false)\r\n                        this.loader = false\r\n                        this.total_objects = response.data.total_objects\r\n                    } else {\r\n                        this.loader = false\r\n                        this.total_objects = response.data.total_objects\r\n\r\n                        // this.throwWagons = response.data.data\r\n                        // this.notifyHead = 'Успешно'\r\n                        // this.notifyMessage = 'Данные отфильтрованы'\r\n                        // this.notifyClass = 'wrapper-success'\r\n                        // this.showNotify = true\r\n                        // setTimeout(this.closeNotification, 1500)\r\n                    }\r\n                }).catch(error => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Данные не получены'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                    // console.log(error.response); вывод ошибок получаемых от сервера\r\n\r\n                })\r\n        },\r\n        DeleteReportAbandoned(id) {\r\n            this.loader = true\r\n            api.deleteReportAbandon(id)\r\n                .then(response => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Успешно'\r\n                    this.notifyMessage = 'Отчет удален'\r\n                    this.notifyClass = 'wrapper-success'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                    this.DownloadReportAbandones()\r\n                }).catch(error => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Отчет не удален'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                })\r\n        },\r\n        updateFilter(filter) {\r\n            this.filter = filter\r\n        },\r\n        closeNotification() {\r\n            this.showNotify = false\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapState({\r\n            user: state => state.auth.user,\r\n            uid: state => state.auth.uid,\r\n        })\r\n    },\r\n}\r\n</script>"]},"metadata":{},"sourceType":"module"}