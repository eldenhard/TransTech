{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __awaiter, __extends, __generator } from \"tslib\";\nimport { PercentSeries } from \"../percent/PercentSeries\";\nimport { Template } from \"../../core/util/Template\";\nimport { ListTemplate } from \"../../core/util/List\";\nimport { FunnelSlice } from \"./FunnelSlice\";\nimport { Tick } from \"../../core/render/Tick\";\nimport { Label } from \"../../core/render/Label\";\nimport { percent, p50, p100 } from \"../../core/util/Percent\";\nimport * as $array from \"../../core/util/Array\";\nimport * as $type from \"../../core/util/Type\";\nimport * as $utils from \"../../core/util/Utils\";\n/**\r\n * Creates a funnel series for use in a [[SlicedChart]].\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/} for more info\r\n * @important\r\n */\n\nvar FunnelSeries =\n/** @class */\nfunction (_super) {\n  __extends(FunnelSeries, _super);\n\n  function FunnelSeries() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    Object.defineProperty(_this, \"_tag\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"funnel\"\n    });\n    /**\r\n     * A [[ListTemplate]] of all slice links in series.\r\n     *\r\n     * `links.template` can also be used to configure slice links.\r\n     *\r\n     * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/#Slice_links} for more info\r\n     */\n\n    Object.defineProperty(_this, \"links\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _this._makeLinks()\n    });\n    Object.defineProperty(_this, \"_total\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 0\n    });\n    Object.defineProperty(_this, \"_count\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 0\n    });\n    Object.defineProperty(_this, \"_nextCoord\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 0\n    });\n    Object.defineProperty(_this, \"_opposite\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    return _this;\n  }\n\n  Object.defineProperty(FunnelSeries.prototype, \"_makeSlices\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      return new ListTemplate(Template.new({}), function () {\n        return FunnelSlice._new(_this._root, {\n          themeTags: $utils.mergeTags(_this.slices.template.get(\"themeTags\", []), [_this._tag, \"series\", \"slice\", _this.get(\"orientation\")])\n        }, [_this.slices.template]);\n      });\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_makeLabels\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      return new ListTemplate(Template.new({}), function () {\n        return Label._new(_this._root, {\n          themeTags: $utils.mergeTags(_this.labels.template.get(\"themeTags\", []), [_this._tag, \"series\", \"label\", _this.get(\"orientation\")])\n        }, [_this.labels.template]);\n      });\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_makeTicks\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      return new ListTemplate(Template.new({}), function () {\n        return Tick._new(_this._root, {\n          themeTags: $utils.mergeTags(_this.ticks.template.get(\"themeTags\", []), [_this._tag, \"series\", \"tick\", _this.get(\"orientation\")])\n        }, [_this.ticks.template]);\n      });\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_makeLinks\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      return new ListTemplate(Template.new({}), function () {\n        return FunnelSlice._new(_this._root, {\n          themeTags: $utils.mergeTags(_this.links.template.get(\"themeTags\", []), [_this._tag, \"series\", \"link\", _this.get(\"orientation\")])\n        }, [_this.links.template]);\n      });\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(FunnelSeries.prototype, \"makeLink\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var link = this.slicesContainer.children.push(this.links.make());\n\n      link._setDataItem(dataItem);\n\n      dataItem.set(\"link\", link);\n      this.links.push(link);\n      return link;\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_afterNew\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      _super.prototype._afterNew.call(this);\n\n      var slicesContainer = this.slicesContainer;\n      slicesContainer.setAll({\n        isMeasured: true,\n        position: \"relative\",\n        width: percent(100),\n        height: percent(100)\n      });\n      slicesContainer.onPrivate(\"width\", function () {\n        _this.markDirtySize();\n      });\n      slicesContainer.onPrivate(\"height\", function () {\n        _this.markDirtySize();\n      });\n\n      if (this.get(\"orientation\") == \"vertical\") {\n        this.set(\"layout\", this._root.horizontalLayout);\n      } else {\n        this.set(\"layout\", this._root.verticalLayout);\n      }\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"processDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var _this = this;\n\n      _super.prototype.processDataItem.call(this, dataItem);\n\n      var slice = this.makeSlice(dataItem);\n\n      slice._setDataItem(dataItem);\n\n      dataItem.set(\"slice\", slice);\n      this.makeLink(dataItem);\n      var label = this.makeLabel(dataItem);\n      label.on(\"x\", function () {\n        _this._updateTick(dataItem);\n      });\n      label.on(\"y\", function () {\n        _this._updateTick(dataItem);\n      });\n      this.makeTick(dataItem);\n      slice.events.on(\"positionchanged\", function () {\n        label.markDirty();\n      });\n      slice.events.on(\"boundschanged\", function () {\n        var dataItem = slice.dataItem;\n\n        if (dataItem) {\n          _this._updateTick(dataItem);\n        }\n      });\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_updateChildren\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      this._opposite = false;\n\n      if (this.children.indexOf(this.labelsContainer) == 0) {\n        this._opposite = true;\n      }\n\n      var total = 0;\n      var count = 0;\n      $array.each(this.dataItems, function (dataItem) {\n        var value = dataItem.get(\"value\");\n\n        if ($type.isNumber(value)) {\n          count++;\n\n          if (value > 0) {\n            total += Math.abs(dataItem.get(\"valueWorking\", value) / value);\n          } else {\n            if (_this.get(\"ignoreZeroValues\", false)) {\n              count--;\n            } else {\n              if (dataItem.isHidden()) {\n                count--;\n              } else {\n                total += 1;\n              }\n            }\n          }\n        }\n      });\n      this._total = 1 / count * total;\n      this._count = count;\n\n      if (this.isDirty(\"alignLabels\")) {\n        this._fixLayout();\n      }\n\n      if (this._total > 0 && (this._valuesDirty || this._sizeDirty)) {\n        var slicesContainer = this.slicesContainer;\n        var h = void 0;\n\n        if (this.get(\"orientation\") == \"vertical\") {\n          h = slicesContainer.innerHeight();\n        } else {\n          h = slicesContainer.innerWidth();\n        }\n\n        this._nextCoord = this.get(\"startLocation\", 0) * h;\n        this.markDirtyBounds();\n        var i_1 = 0;\n        $array.each(this._dataItems, function (dataItem) {\n          _this.updateLegendValue(dataItem);\n\n          dataItem.set(\"index\", i_1);\n          i_1++;\n          var slice = dataItem.get(\"slice\");\n          var tick = dataItem.get(\"tick\");\n          var label = dataItem.get(\"label\");\n          var link = dataItem.get(\"link\");\n          var color = dataItem.get(\"fill\");\n\n          slice._setDefault(\"fill\", color);\n\n          slice._setDefault(\"stroke\", color);\n\n          link._setDefault(\"fill\", color);\n\n          link._setDefault(\"stroke\", color);\n\n          var value = dataItem.get(\"value\");\n\n          if ($type.isNumber(value)) {\n            if (value == 0 && _this.get(\"ignoreZeroValues\")) {\n              slice.setPrivate(\"visible\", false);\n              tick.setPrivate(\"visible\", false);\n              label.setPrivate(\"visible\", false);\n            } else {\n              slice.setPrivate(\"visible\", true);\n              tick.setPrivate(\"visible\", true);\n              label.setPrivate(\"visible\", true);\n\n              _this.decorateSlice(dataItem);\n\n              if (_this.isLast(dataItem)) {\n                link.setPrivate(\"visible\", false);\n              } else if (!dataItem.isHidden()) {\n                link.setPrivate(\"visible\", true);\n              }\n            }\n          }\n        });\n      }\n\n      _super.prototype._updateChildren.call(this);\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_fixLayout\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var orientation = this.get(\"orientation\");\n      var labelsContainer = this.labelsContainer;\n      var labelsTemplate = this.labels.template;\n\n      if (this.get(\"alignLabels\")) {\n        labelsContainer.set(\"position\", \"relative\");\n        labelsContainer.setAll({\n          isMeasured: true\n        });\n\n        if (orientation == \"vertical\") {\n          this.set(\"layout\", this._root.horizontalLayout);\n          labelsTemplate.setAll({\n            centerX: p100,\n            x: p100\n          });\n        } else {\n          this.set(\"layout\", this._root.verticalLayout);\n          labelsTemplate.setAll({\n            centerX: 0,\n            x: 0\n          });\n        }\n      } else {\n        labelsContainer.setAll({\n          isMeasured: false,\n          position: \"absolute\"\n        });\n\n        if (orientation == \"vertical\") {\n          labelsContainer.setAll({\n            x: p50\n          });\n          labelsTemplate.setAll({\n            centerX: p50,\n            x: 0\n          });\n        } else {\n          labelsContainer.setAll({\n            y: p50\n          });\n          labelsTemplate.setAll({\n            centerX: p50,\n            y: 0\n          });\n        }\n      }\n\n      this.markDirtySize();\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"getNextValue\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var index = dataItem.get(\"index\");\n      var nextValue = dataItem.get(\"valueWorking\", 0);\n\n      if (index < this.dataItems.length - 1) {\n        var nextItem = this.dataItems[index + 1];\n        nextValue = nextItem.get(\"valueWorking\", 0);\n\n        if (nextItem.isHidden() || nextItem.get(\"value\") == 0 && this.get(\"ignoreZeroValues\")) {\n          return this.getNextValue(nextItem);\n        }\n      }\n\n      return nextValue;\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"isLast\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var index = dataItem.get(\"index\");\n\n      if (index == this.dataItems.length - 1) {\n        return true;\n      } else {\n        for (var i = index + 1; i < this.dataItems.length; i++) {\n          if (!this.dataItems[i].isHidden()) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"decorateSlice\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var orientation = this.get(\"orientation\");\n      var slice = dataItem.get(\"slice\");\n      var label = dataItem.get(\"label\");\n      var link = dataItem.get(\"link\");\n      var slicesContainer = this.slicesContainer;\n      var maxWidth = slicesContainer.innerWidth();\n      var maxHeight = slicesContainer.innerHeight();\n      var maxSize = maxWidth;\n\n      if (orientation == \"horizontal\") {\n        maxSize = maxHeight;\n      }\n\n      var nextValue = this.getNextValue(dataItem);\n      var value = dataItem.get(\"value\", 0);\n      var workingValue = Math.abs(dataItem.get(\"valueWorking\", value));\n      var bottomRatio = this.get(\"bottomRatio\", 0);\n      var valueHigh = this.getPrivate(\"valueHigh\", 0);\n      var d = 1;\n\n      if (value != 0) {\n        d = workingValue / Math.abs(value);\n      } else {\n        if (dataItem.isHidden()) {\n          d = 0.000001;\n        }\n      }\n\n      if (this._nextCoord == Infinity) {\n        this._nextCoord = 0;\n      }\n\n      var topWidth = workingValue / valueHigh * maxSize;\n      var bottomWidth = (workingValue - (workingValue - nextValue) * bottomRatio) / valueHigh * maxSize;\n      slice.setAll({\n        topWidth: topWidth,\n        bottomWidth: bottomWidth,\n        orientation: orientation\n      });\n      link.setAll({\n        topWidth: bottomWidth,\n        bottomWidth: (workingValue - (workingValue - nextValue)) / valueHigh * maxSize,\n        orientation: orientation\n      });\n      var startLocation = this.get(\"startLocation\", 0);\n      var endLocation = this.get(\"endLocation\", 1);\n\n      if (orientation == \"vertical\") {\n        var linkHeight = link.height() * d;\n        maxHeight = maxHeight * (endLocation - startLocation) + linkHeight;\n        slice.set(\"y\", this._nextCoord);\n        var height = Math.min(100000, Math.max(0, maxHeight / this._count * d / this._total - linkHeight));\n        slice.setAll({\n          height: height,\n          x: maxWidth / 2\n        });\n        var labelY = this._nextCoord + height / 2;\n        label.set(\"y\", labelY);\n        this._nextCoord += height + linkHeight;\n        link.setAll({\n          y: this._nextCoord - linkHeight,\n          x: maxWidth / 2\n        });\n      } else {\n        var linkHeight = link.width() * d;\n        maxWidth = maxWidth * (endLocation - startLocation) + linkHeight;\n        slice.set(\"x\", this._nextCoord);\n        var width = Math.min(100000, Math.max(0, maxWidth / this._count * d / this._total - linkHeight));\n        slice.setAll({\n          width: width,\n          y: maxHeight / 2\n        });\n        var labelX = this._nextCoord + width / 2;\n        label.set(\"x\", labelX);\n        this._nextCoord += width + linkHeight;\n        link.setAll({\n          x: this._nextCoord - linkHeight,\n          y: maxHeight / 2\n        });\n      }\n    }\n  });\n  /**\r\n   * Hides series's data item.\r\n   *\r\n   * @param   dataItem  Data item\r\n   * @param   duration  Animation duration in milliseconds\r\n   * @return            Promise\r\n   */\n\n  Object.defineProperty(FunnelSeries.prototype, \"hideDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem, duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          dataItem.get(\"link\").hide(duration);\n          return [2\n          /*return*/\n          , _super.prototype.hideDataItem.call(this, dataItem, duration)];\n        });\n      });\n    }\n  });\n  /**\r\n   * Shows series's data item.\r\n   *\r\n   * @param   dataItem  Data item\r\n   * @param   duration  Animation duration in milliseconds\r\n   * @return            Promise\r\n   */\n\n  Object.defineProperty(FunnelSeries.prototype, \"showDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem, duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          dataItem.get(\"link\").show(duration);\n          return [2\n          /*return*/\n          , _super.prototype.showDataItem.call(this, dataItem, duration)];\n        });\n      });\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_updateTick\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      if (this.get(\"alignLabels\")) {\n        var tick = dataItem.get(\"tick\");\n        var label = dataItem.get(\"label\");\n        var slice = dataItem.get(\"slice\");\n\n        if (tick && slice && label) {\n          var labelsContainer = this.labelsContainer;\n          var slicesContainer = this.slicesContainer;\n          var tickLocation = tick.get(\"location\", 0.5);\n          var lcw = labelsContainer.width();\n          var lch = labelsContainer.height();\n          var pl = labelsContainer.get(\"paddingLeft\", 0);\n          var pr = labelsContainer.get(\"paddingRight\", 0);\n          var pt = labelsContainer.get(\"paddingTop\", 0);\n          var pb = labelsContainer.get(\"paddingBottom\", 0);\n          var p0 = {\n            x: 0,\n            y: 0\n          };\n          var p1 = {\n            x: 0,\n            y: 0\n          };\n          var p2 = {\n            x: 0,\n            y: 0\n          };\n\n          if (this._opposite) {\n            tickLocation = 1 - tickLocation;\n          }\n\n          if (this.get(\"orientation\") == \"vertical\") {\n            p0 = slice.getPoint(tickLocation, 0.5);\n            p0.x += slice.x() + slicesContainer.x();\n            p0.y += slice.y() + slicesContainer.y();\n\n            if (this._opposite) {\n              p1.x = lcw;\n              p1.y = label.y();\n              p2.x = lcw - pl;\n              p2.y = p1.y;\n            } else {\n              p1.x = slicesContainer.x() + slicesContainer.width();\n              p1.y = label.y();\n              p2.x = p1.x + lcw - label.width() - pr;\n              p2.y = p1.y;\n            }\n          } else {\n            p0 = slice.getPoint(0.5, tickLocation);\n            p0.x += slice.x() + slicesContainer.x();\n            p0.y += slice.y() + slicesContainer.y();\n\n            if (this._opposite) {\n              p1.y = lch;\n              p1.x = label.x();\n              p2.y = lch - pt;\n              p2.x = p1.x;\n            } else {\n              p1.y = slicesContainer.y() + slicesContainer.height();\n              p1.x = label.x();\n              p2.y = p1.y + lch - label.height() - pb;\n              p2.x = p1.x;\n            }\n          }\n\n          tick.set(\"points\", [p0, p1, p2]);\n        }\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(FunnelSeries.prototype, \"disposeDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      _super.prototype.disposeDataItem.call(this, dataItem);\n\n      var link = dataItem.get(\"link\");\n\n      if (link) {\n        this.links.removeValue(link);\n        link.dispose();\n      }\n    }\n  });\n  Object.defineProperty(FunnelSeries.prototype, \"_positionBullet\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (bullet) {\n      var sprite = bullet.get(\"sprite\");\n\n      if (sprite) {\n        var dataItem = sprite.dataItem;\n        var slice = dataItem.get(\"slice\");\n\n        if (slice) {\n          var width = slice.width();\n          var height = slice.height();\n          var locationX = bullet.get(\"locationX\", 0.5);\n          var locationY = bullet.get(\"locationY\", 0.5);\n          var dx = 0;\n          var dy = 0;\n\n          if (this.get(\"orientation\") == \"horizontal\") {\n            dy = height / 2;\n          } else {\n            dx = width / 2;\n          }\n\n          sprite.setAll({\n            x: slice.x() + width * locationX - dx,\n            y: slice.y() - dy + height * locationY\n          });\n        }\n      }\n    }\n  });\n  Object.defineProperty(FunnelSeries, \"className\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: \"FunnelSeries\"\n  });\n  Object.defineProperty(FunnelSeries, \"classNames\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: PercentSeries.classNames.concat([FunnelSeries.className])\n  });\n  return FunnelSeries;\n}(PercentSeries);\n\nexport { FunnelSeries };","map":{"version":3,"mappings":"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","names":["PercentSeries","Template","ListTemplate","FunnelSlice","Tick","Label","percent","p50","p100","$array","$type","$utils","__extends","Object","_this","_makeLinks","new","_new","_root","themeTags","mergeTags","slices","template","get","_tag","labels","ticks","links","dataItem","link","slicesContainer","children","push","make","_setDataItem","set","_super","_afterNew","call","setAll","isMeasured","position","width","height","onPrivate","markDirtySize","horizontalLayout","verticalLayout","processDataItem","slice","makeSlice","makeLink","label","makeLabel","on","_updateTick","makeTick","events","markDirty","_opposite","indexOf","labelsContainer","total","count","each","dataItems","value","isNumber","Math","abs","isHidden","_total","_count","isDirty","_fixLayout","_valuesDirty","_sizeDirty","h","innerHeight","innerWidth","_nextCoord","markDirtyBounds","i_1","_dataItems","updateLegendValue","tick","color","_setDefault","setPrivate","decorateSlice","isLast","_updateChildren","orientation","labelsTemplate","centerX","x","y","index","nextValue","length","nextItem","getNextValue","i","maxWidth","maxHeight","maxSize","workingValue","bottomRatio","valueHigh","getPrivate","d","Infinity","topWidth","bottomWidth","startLocation","endLocation","linkHeight","min","max","labelY","labelX","duration","hide","hideDataItem","show","showDataItem","tickLocation","lcw","lch","pl","pr","pt","pb","p0","p1","p2","getPoint","disposeDataItem","removeValue","dispose","bullet","sprite","locationX","locationY","dx","dy","classNames","concat","FunnelSeries","className"],"sourceRoot":"","sources":["../../../../../src/.internal/charts/funnel/FunnelSeries.ts"],"sourcesContent":["import type { DataItem } from \"../../core/render/Component\";\nimport type { SlicedChart } from \"./SlicedChart\";\n\nimport { PercentSeries, IPercentSeriesSettings, IPercentSeriesDataItem, IPercentSeriesPrivate } from \"../percent/PercentSeries\";\nimport { Template } from \"../../core/util/Template\";\nimport { ListTemplate } from \"../../core/util/List\";\nimport { FunnelSlice } from \"./FunnelSlice\";\nimport { Tick } from \"../../core/render/Tick\";\nimport { Label } from \"../../core/render/Label\";\nimport { percent, p50, p100 } from \"../../core/util/Percent\";\nimport type { Bullet } from \"../../core/render/Bullet\";\n\nimport * as $array from \"../../core/util/Array\";\nimport * as $type from \"../../core/util/Type\";\nimport * as $utils from \"../../core/util/Utils\";\n\n\nexport interface IFunnelSeriesDataItem extends IPercentSeriesDataItem {\n\n\t/**\n\t * A related slice element.\n\t */\n\tslice: FunnelSlice;\n\n\t/**\n\t * A related slice link element\n\t */\n\tlink: FunnelSlice;\n\n\t/**\n\t * Data item's index.\n\t */\n\tindex: number;\n\n}\n\nexport interface IFunnelSeriesSettings extends IPercentSeriesSettings {\n\n\t/**\n\t * Width of the bottom edge of the slice relative to the top edge of the next\n\t * slice.\n\t *\n\t * `1` - means the full width of the slice, resulting in a rectangle.\n\t * `0` - means using width of the next slice, resulting in a trapezoid.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/#Slice_bottom_width} for more info\n\t * @default 1\n\t */\n\tbottomRatio?: number;\n\n\t/**\n\t * Orientation of the series.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/#Series_orientation} for more info\n\t * @default \"vertical\"\n\t */\n\torientation: \"horizontal\" | \"vertical\";\n\n\t/**\n\t * If set to `true`, series will not create slices for data items with zero\n\t * value.\n\t */\n\tignoreZeroValues?: boolean;\n\n\t/**\n\t * Should labels be aligned into columns/rows?\n\t *\n\t * @default false\n\t */\n\talignLabels?: boolean;\n\n\t/**\n\t * Relative location within area available to series where it should start.\n\t *\n\t * `0` - beginning, `1` - end, or any intermediate value.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/#Start_end_locations} for more info\n\t * @default 0\n\t */\n\tstartLocation?: number;\n\n\t/**\n\t * Relative location within area available to series where it should start.\n\t *\n\t * `0` - beginning, `1` - end, or any intermediate value.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/#Start_end_locations} for more info\n\t * @default 0\n\t */\n\tendLocation?: number;\n\n}\n\nexport interface IFunnelSeriesPrivate extends IPercentSeriesPrivate {\n}\n\n/**\n * Creates a funnel series for use in a [[SlicedChart]].\n *\n * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/} for more info\n * @important\n */\nexport class FunnelSeries extends PercentSeries {\n\n\t/**\n\t * A chart series is attached to.\n\t */\n\tdeclare public chart: SlicedChart | undefined;\n\n\tprotected _tag = \"funnel\";\n\n\tdeclare public _sliceType: FunnelSlice;\n\tdeclare public _labelType: Label;\n\tdeclare public _tickType: Tick;\n\n\tprotected _makeSlices(): ListTemplate<this[\"_sliceType\"]> {\n\t\treturn new ListTemplate(\n\t\t\tTemplate.new({}),\n\t\t\t() => FunnelSlice._new(this._root, {\n\t\t\t\tthemeTags: $utils.mergeTags(this.slices.template.get(\"themeTags\", []), [this._tag, \"series\", \"slice\", this.get(\"orientation\")])\n\t\t\t}, [this.slices.template])\n\t\t);\n\t}\n\n\tprotected _makeLabels(): ListTemplate<this[\"_labelType\"]> {\n\t\treturn new ListTemplate(\n\t\t\tTemplate.new({}),\n\t\t\t() => Label._new(this._root, {\n\t\t\t\tthemeTags: $utils.mergeTags(this.labels.template.get(\"themeTags\", []), [this._tag, \"series\", \"label\", this.get(\"orientation\")])\n\t\t\t}, [this.labels.template])\n\t\t);\n\t}\n\n\tprotected _makeTicks(): ListTemplate<this[\"_tickType\"]> {\n\t\treturn new ListTemplate(\n\t\t\tTemplate.new({}),\n\t\t\t() => Tick._new(this._root, {\n\t\t\t\tthemeTags: $utils.mergeTags(this.ticks.template.get(\"themeTags\", []), [this._tag, \"series\", \"tick\", this.get(\"orientation\")])\n\t\t\t}, [this.ticks.template])\n\t\t);\n\t}\n\n\t/**\n\t * A [[ListTemplate]] of all slice links in series.\n\t *\n\t * `links.template` can also be used to configure slice links.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/charts/percent-charts/sliced-chart/funnel-series/#Slice_links} for more info\n\t */\n\tpublic readonly links: ListTemplate<this[\"_sliceType\"]> = this._makeLinks();\n\n\tprotected _makeLinks(): ListTemplate<this[\"_sliceType\"]> {\n\t\treturn new ListTemplate(\n\t\t\tTemplate.new({}),\n\t\t\t() => FunnelSlice._new(this._root, {\n\t\t\t\tthemeTags: $utils.mergeTags(this.links.template.get(\"themeTags\", []), [this._tag, \"series\", \"link\", this.get(\"orientation\")])\n\t\t\t}, [this.links.template]),\n\t\t);\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic makeLink(dataItem: DataItem<this[\"_dataItemSettings\"]>): this[\"_sliceType\"] {\n\t\tconst link = this.slicesContainer.children.push(this.links.make());\n\t\tlink._setDataItem(dataItem);\n\t\tdataItem.set(\"link\", link);\n\t\tthis.links.push(link);\n\t\treturn link;\n\t}\n\n\tpublic static className: string = \"FunnelSeries\";\n\tpublic static classNames: Array<string> = PercentSeries.classNames.concat([FunnelSeries.className]);\n\n\tdeclare public _settings: IFunnelSeriesSettings;\n\tdeclare public _privateSettings: IFunnelSeriesPrivate;\n\tdeclare public _dataItemSettings: IFunnelSeriesDataItem;\n\n\tprotected _total: number = 0;\n\tprotected _count: number = 0;\n\tprotected _nextCoord: number = 0;\n\n\tprotected _opposite: boolean = false;\n\n\tprotected _afterNew() {\n\t\tsuper._afterNew();\n\t\tconst slicesContainer = this.slicesContainer;\n\t\tslicesContainer.setAll({ isMeasured: true, position: \"relative\", width: percent(100), height: percent(100) });\n\t\tslicesContainer.onPrivate(\"width\", () => {\n\t\t\tthis.markDirtySize();\n\t\t})\n\n\t\tslicesContainer.onPrivate(\"height\", () => {\n\t\t\tthis.markDirtySize();\n\t\t})\n\n\t\tif (this.get(\"orientation\") == \"vertical\") {\n\t\t\tthis.set(\"layout\", this._root.horizontalLayout);\n\t\t}\n\t\telse {\n\t\t\tthis.set(\"layout\", this._root.verticalLayout);\n\t\t}\n\t}\n\n\tprotected processDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>) {\n\t\tsuper.processDataItem(dataItem);\n\n\t\tconst slice = this.makeSlice(dataItem);\n\n\t\tslice._setDataItem(dataItem);\n\n\t\tdataItem.set(\"slice\", slice);\n\n\t\tthis.makeLink(dataItem);\n\t\tconst label = this.makeLabel(dataItem);\n\n\t\tlabel.on(\"x\", () => {\n\t\t\tthis._updateTick(dataItem);\n\t\t})\n\n\t\tlabel.on(\"y\", () => {\n\t\t\tthis._updateTick(dataItem);\n\t\t})\n\n\t\tthis.makeTick(dataItem);\n\n\t\tslice.events.on(\"positionchanged\", () => {\n\t\t\tlabel.markDirty();\n\t\t})\n\n\t\tslice.events.on(\"boundschanged\", () => {\n\t\t\tconst dataItem = slice.dataItem;\n\t\t\tif (dataItem) {\n\t\t\t\tthis._updateTick(dataItem as any);\n\t\t\t}\n\t\t})\n\t}\n\n\n\tpublic _updateChildren() {\n\t\tthis._opposite = false;\n\t\tif (this.children.indexOf(this.labelsContainer) == 0) {\n\t\t\tthis._opposite = true;\n\t\t}\n\n\t\tlet total = 0;\n\t\tlet count = 0;\n\n\t\t$array.each(this.dataItems, (dataItem) => {\n\t\t\tconst value = dataItem.get(\"value\");\n\t\t\tif ($type.isNumber(value)) {\n\t\t\t\tcount++;\n\t\t\t\tif (value > 0) {\n\t\t\t\t\ttotal += Math.abs(dataItem.get(\"valueWorking\", value) / value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (this.get(\"ignoreZeroValues\", false)) {\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (dataItem.isHidden()) {\n\t\t\t\t\t\t\tcount--;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttotal += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis._total = 1 / count * total;\n\t\tthis._count = count;\n\n\t\tif (this.isDirty(\"alignLabels\")) {\n\t\t\tthis._fixLayout();\n\t\t}\n\n\t\tif (this._total > 0 && (this._valuesDirty || this._sizeDirty)) {\n\n\t\t\tconst slicesContainer = this.slicesContainer;\n\n\t\t\tlet h: number;\n\t\t\tif (this.get(\"orientation\") == \"vertical\") {\n\t\t\t\th = slicesContainer.innerHeight();\n\t\t\t}\n\t\t\telse {\n\t\t\t\th = slicesContainer.innerWidth();\n\t\t\t}\n\n\t\t\tthis._nextCoord = this.get(\"startLocation\", 0) * h;\n\n\t\t\tthis.markDirtyBounds();\n\n\t\t\tlet i = 0;\n\t\t\t$array.each(this._dataItems, (dataItem) => {\n\t\t\t\tthis.updateLegendValue(dataItem);\n\n\t\t\t\tdataItem.set(\"index\", i);\n\t\t\t\ti++;\n\n\t\t\t\tconst slice = dataItem.get(\"slice\");\n\t\t\t\tconst tick = dataItem.get(\"tick\");\n\t\t\t\tconst label = dataItem.get(\"label\");\n\t\t\t\tconst link = dataItem.get(\"link\");\n\t\t\t\tconst color = dataItem.get(\"fill\");\n\n\t\t\t\tslice._setDefault(\"fill\", color);\n\t\t\t\tslice._setDefault(\"stroke\", color);\n\t\t\t\tlink._setDefault(\"fill\", color);\n\t\t\t\tlink._setDefault(\"stroke\", color);\n\n\t\t\t\tconst value = dataItem.get(\"value\");\n\t\t\t\tif ($type.isNumber(value)) {\n\t\t\t\t\tif (value == 0 && this.get(\"ignoreZeroValues\")) {\n\t\t\t\t\t\tslice.setPrivate(\"visible\", false);\n\t\t\t\t\t\ttick.setPrivate(\"visible\", false);\n\t\t\t\t\t\tlabel.setPrivate(\"visible\", false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tslice.setPrivate(\"visible\", true);\n\t\t\t\t\t\ttick.setPrivate(\"visible\", true);\n\t\t\t\t\t\tlabel.setPrivate(\"visible\", true);\n\n\t\t\t\t\t\tthis.decorateSlice(dataItem);\n\n\t\t\t\t\t\tif (this.isLast(dataItem)) {\n\t\t\t\t\t\t\tlink.setPrivate(\"visible\", false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!dataItem.isHidden()) {\n\t\t\t\t\t\t\tlink.setPrivate(\"visible\", true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tsuper._updateChildren();\n\t}\n\n\tprotected _fixLayout() {\n\n\t\tconst orientation = this.get(\"orientation\");\n\t\tconst labelsContainer = this.labelsContainer;\n\t\tconst labelsTemplate = this.labels.template;\n\n\t\tif (this.get(\"alignLabels\")) {\n\t\t\tlabelsContainer.set(\"position\", \"relative\");\n\t\t\tlabelsContainer.setAll({ isMeasured: true });\n\t\t\tif (orientation == \"vertical\") {\n\t\t\t\tthis.set(\"layout\", this._root.horizontalLayout);\n\t\t\t\tlabelsTemplate.setAll({ centerX: p100, x: p100 });\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.set(\"layout\", this._root.verticalLayout);\n\t\t\t\tlabelsTemplate.setAll({ centerX: 0, x: 0 });\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlabelsContainer.setAll({ isMeasured: false, position: \"absolute\" });\n\t\t\tif (orientation == \"vertical\") {\n\t\t\t\tlabelsContainer.setAll({ x: p50 });\n\t\t\t\tlabelsTemplate.setAll({ centerX: p50, x: 0 });\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlabelsContainer.setAll({ y: p50 });\n\t\t\t\tlabelsTemplate.setAll({ centerX: p50, y: 0 });\n\t\t\t}\n\t\t}\n\t\tthis.markDirtySize();\n\t}\n\n\tprotected getNextValue(dataItem: DataItem<this[\"_dataItemSettings\"]>): number {\n\t\tlet index = dataItem.get(\"index\");\n\t\tlet nextValue = dataItem.get(\"valueWorking\", 0);\n\t\tif (index < this.dataItems.length - 1) {\n\t\t\tlet nextItem = this.dataItems[index + 1];\n\t\t\tnextValue = nextItem.get(\"valueWorking\", 0);\n\n\t\t\tif (nextItem.isHidden() || (nextItem.get(\"value\") == 0 && this.get(\"ignoreZeroValues\"))) {\n\t\t\t\treturn this.getNextValue(nextItem);\n\t\t\t}\n\t\t}\n\t\treturn nextValue;\n\t}\n\n\tprotected isLast(dataItem: DataItem<this[\"_dataItemSettings\"]>): boolean {\n\t\tlet index = dataItem.get(\"index\");\n\t\tif (index == this.dataItems.length - 1) {\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\tfor (let i = index + 1; i < this.dataItems.length; i++) {\n\t\t\t\tif (!this.dataItems[i].isHidden()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tprotected decorateSlice(dataItem: DataItem<this[\"_dataItemSettings\"]>) {\n\t\tconst orientation = this.get(\"orientation\");\n\n\t\tconst slice = dataItem.get(\"slice\");\n\t\tconst label = dataItem.get(\"label\");\n\t\tconst link = dataItem.get(\"link\");\n\n\t\tconst slicesContainer = this.slicesContainer;\n\n\t\tlet maxWidth = slicesContainer.innerWidth();\n\t\tlet maxHeight = slicesContainer.innerHeight();\n\n\t\tlet maxSize = maxWidth;\n\t\tif (orientation == \"horizontal\") {\n\t\t\tmaxSize = maxHeight;\n\t\t}\n\n\t\tconst nextValue = this.getNextValue(dataItem);\n\t\tconst value = dataItem.get(\"value\", 0);\n\t\tconst workingValue = Math.abs(dataItem.get(\"valueWorking\", value));\n\t\tconst bottomRatio = this.get(\"bottomRatio\", 0);\n\t\tconst valueHigh = this.getPrivate(\"valueHigh\", 0);\n\n\n\t\tlet d = 1;\n\t\tif (value != 0) {\n\t\t\td = workingValue / Math.abs(value);\n\t\t}\n\t\telse {\n\t\t\tif (dataItem.isHidden()) {\n\t\t\t\td = 0.000001;\n\t\t\t}\n\t\t}\n\n\t\tif (this._nextCoord == Infinity) {\n\t\t\tthis._nextCoord = 0;\n\t\t}\n\n\t\tlet topWidth = workingValue / valueHigh * maxSize;\n\t\tlet bottomWidth = (workingValue - (workingValue - nextValue) * bottomRatio) / valueHigh * maxSize;\n\n\t\tslice.setAll({ topWidth, bottomWidth, orientation });\n\t\tlink.setAll({ topWidth: bottomWidth, bottomWidth: (workingValue - (workingValue - nextValue)) / valueHigh * maxSize, orientation });\n\n\t\tconst startLocation = this.get(\"startLocation\", 0);\n\t\tconst endLocation = this.get(\"endLocation\", 1);\n\n\t\tif (orientation == \"vertical\") {\n\n\t\t\tlet linkHeight = link.height() * d;\n\n\t\t\tmaxHeight = maxHeight * (endLocation - startLocation) + linkHeight;\n\n\t\t\tslice.set(\"y\", this._nextCoord);\n\n\t\t\tlet height = Math.min(100000, Math.max(0, maxHeight / this._count * d / this._total - linkHeight));\n\n\t\t\tslice.setAll({ height, x: maxWidth / 2 });\n\t\t\tlet labelY = this._nextCoord + height / 2;\n\t\t\tlabel.set(\"y\", labelY);\n\n\t\t\tthis._nextCoord += height + linkHeight;\n\t\t\tlink.setAll({ y: this._nextCoord - linkHeight, x: maxWidth / 2 });\n\t\t}\n\t\telse {\n\t\t\tlet linkHeight = link.width() * d;\n\n\t\t\tmaxWidth = maxWidth * (endLocation - startLocation) + linkHeight;\n\n\t\t\tslice.set(\"x\", this._nextCoord);\n\n\t\t\tlet width = Math.min(100000, Math.max(0, maxWidth / this._count * d / this._total - linkHeight));\n\n\t\t\tslice.setAll({ width, y: maxHeight / 2 });\n\t\t\tconst labelX = this._nextCoord + width / 2;\n\t\t\tlabel.set(\"x\", labelX);\n\n\t\t\tthis._nextCoord += width + linkHeight;\n\t\t\tlink.setAll({ x: this._nextCoord - linkHeight, y: maxHeight / 2 });\n\t\t}\n\t}\n\n\t/**\n\t * Hides series's data item.\n\t *\n\t * @param   dataItem  Data item\n\t * @param   duration  Animation duration in milliseconds\n\t * @return            Promise\n\t */\n\tpublic async hideDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>, duration?: number): Promise<void> {\n\t\tdataItem.get(\"link\").hide(duration);\n\t\treturn super.hideDataItem(dataItem, duration)\n\t}\n\n\t/**\n\t * Shows series's data item.\n\t *\n\t * @param   dataItem  Data item\n\t * @param   duration  Animation duration in milliseconds\n\t * @return            Promise\n\t */\n\tpublic async showDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>, duration?: number): Promise<void> {\n\t\tdataItem.get(\"link\").show(duration);\n\t\treturn super.showDataItem(dataItem, duration)\n\t}\n\n\tprotected _updateTick(dataItem: DataItem<this[\"_dataItemSettings\"]>) {\n\t\tif (this.get(\"alignLabels\")) {\n\t\t\tconst tick = dataItem.get(\"tick\");\n\t\t\tconst label = dataItem.get(\"label\");\n\t\t\tconst slice = dataItem.get(\"slice\");\n\n\t\t\tif (tick && slice && label) {\n\n\t\t\t\tconst labelsContainer = this.labelsContainer;\n\t\t\t\tconst slicesContainer = this.slicesContainer;\n\t\t\t\tlet tickLocation = tick.get(\"location\", 0.5);\n\n\t\t\t\tconst lcw = labelsContainer.width();\n\t\t\t\tconst lch = labelsContainer.height();\n\n\t\t\t\tconst pl = labelsContainer.get(\"paddingLeft\", 0);\n\t\t\t\tconst pr = labelsContainer.get(\"paddingRight\", 0);\n\t\t\t\tconst pt = labelsContainer.get(\"paddingTop\", 0);\n\t\t\t\tconst pb = labelsContainer.get(\"paddingBottom\", 0);\n\n\t\t\t\tlet p0 = { x: 0, y: 0 };\n\t\t\t\tlet p1 = { x: 0, y: 0 };\n\t\t\t\tlet p2 = { x: 0, y: 0 };\n\n\t\t\t\tif (this._opposite) {\n\t\t\t\t\ttickLocation = 1 - tickLocation;\n\t\t\t\t}\n\n\t\t\t\tif (this.get(\"orientation\") == \"vertical\") {\n\t\t\t\t\tp0 = slice.getPoint(tickLocation, 0.5);\n\t\t\t\t\tp0.x += slice.x() + slicesContainer.x();\n\t\t\t\t\tp0.y += slice.y() + slicesContainer.y();\n\n\t\t\t\t\tif (this._opposite) {\n\t\t\t\t\t\tp1.x = lcw;\n\t\t\t\t\t\tp1.y = label.y();\n\n\t\t\t\t\t\tp2.x = lcw - pl;\n\t\t\t\t\t\tp2.y = p1.y;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp1.x = slicesContainer.x() + slicesContainer.width();\n\t\t\t\t\t\tp1.y = label.y();\n\n\t\t\t\t\t\tp2.x = p1.x + lcw - label.width() - pr;\n\t\t\t\t\t\tp2.y = p1.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tp0 = slice.getPoint(0.5, tickLocation);\n\t\t\t\t\tp0.x += slice.x() + slicesContainer.x();\n\t\t\t\t\tp0.y += slice.y() + slicesContainer.y();\n\n\t\t\t\t\tif (this._opposite) {\n\t\t\t\t\t\tp1.y = lch;\n\t\t\t\t\t\tp1.x = label.x();\n\n\t\t\t\t\t\tp2.y = lch - pt;\n\t\t\t\t\t\tp2.x = p1.x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp1.y = slicesContainer.y() + slicesContainer.height();\n\t\t\t\t\t\tp1.x = label.x();\n\n\t\t\t\t\t\tp2.y = p1.y + lch - label.height() - pb;\n\t\t\t\t\t\tp2.x = p1.x;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttick.set(\"points\", [p0, p1, p2]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic disposeDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>) {\n\t\tsuper.disposeDataItem(dataItem);\n\t\tlet link = dataItem.get(\"link\");\n\t\tif (link) {\n\t\t\tthis.links.removeValue(link);\n\t\t\tlink.dispose();\n\t\t}\n\t}\n\n\tpublic _positionBullet(bullet: Bullet) {\n\n\t\tconst sprite = bullet.get(\"sprite\");\n\t\tif (sprite) {\n\t\t\tconst dataItem = sprite.dataItem as DataItem<this[\"_dataItemSettings\"]>;\n\t\t\tconst slice = dataItem.get(\"slice\");\n\n\t\t\tif (slice) {\n\t\t\t\tconst width = slice.width();\n\t\t\t\tconst height = slice.height();\n\t\t\t\tconst locationX = bullet.get(\"locationX\", 0.5);\n\t\t\t\tconst locationY = bullet.get(\"locationY\", 0.5);\n\n\t\t\t\tlet dx = 0;\n\t\t\t\tlet dy = 0;\n\t\t\t\tif (this.get(\"orientation\") == \"horizontal\") {\n\t\t\t\t\tdy = height / 2\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdx = width / 2\n\t\t\t\t}\n\n\t\t\t\tsprite.setAll({ x: slice.x() + width * locationX - dx, y: slice.y() - dy + height * locationY });\n\t\t\t}\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}