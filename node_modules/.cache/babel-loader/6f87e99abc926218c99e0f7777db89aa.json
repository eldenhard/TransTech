{"ast":null,"code":"import api from '@/api/directory';\nimport apiReport from '@/api/report';\nimport { mapState } from 'vuex';\nimport Loader from '@/components/loader/loader.vue';\nimport filterDirectory from '@/components/filter/FilterDirectory.vue';\nimport groups from '@/helpers/groups';\nimport Notifications from '@/components/notifications/Notifications.vue';\nexport default {\n  name: 'PartnerTable',\n  components: {\n    Loader,\n    filterDirectory,\n    Notifications\n  },\n\n  data() {\n    return {\n      groups: groups.groups,\n      nextLink: null,\n      prevLink: null,\n      counterparties: [],\n      loader: false,\n      filter_directory: {\n        search: ''\n      },\n      loader: false,\n      total_objects: '',\n      amount: '',\n      work_name: '',\n      short_name: '',\n      full_name: '',\n      els: '',\n      ogrn: '',\n      inn: '',\n      kpp: '',\n      legal_address: '',\n      manager: '',\n      phone: '',\n      group: '',\n      // Уведомления\n      showNotify: false,\n      notifyHead: '',\n      notifyMessage: '',\n      notifyClass: '',\n      name: ''\n    };\n  },\n\n  methods: {\n    goToPage(link) {\n      let url = new URL(link);\n      let pageNumber = url.searchParams.get(\"page\");\n\n      if (pageNumber != null) {\n        this.filter_directory.page = pageNumber;\n      } else {\n        delete this.filter_directory.page;\n      }\n\n      this.getCounterparties();\n    },\n\n    getCounterparties() {\n      this.loader = true;\n      api.getAllcounterparties(this.filter_directory).then(response => {\n        this.counterparties = response.data.data;\n        this.nextLink = response.data.links.next;\n        this.prevLink = response.data.links.previous;\n        this.total_objects = response.data.total_objects;\n        this.amount = response.data.amount;\n        this.notifyHead = 'Успешно';\n        this.notifyMessage = 'Данные отфильтрованы';\n        this.notifyClass = 'wrapper-success';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n        this.loader = false;\n      }).catch(err => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Данные не отфильтрованы, попробуйте еще раз';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      });\n    },\n\n    savePartner(part) {\n      this.loader = true;\n      api.putCounterparties(part.id, part).then(response => {\n        // console.log(response)\n        this.loader = false;\n        this.notifyHead = 'Успешно';\n        this.notifyMessage = 'Данные о контрагенте сохранены';\n        this.notifyClass = 'wrapper-success';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      }).catch(err => {\n        this.loader = false;\n        this.notifyHead = 'Ошибка';\n        this.notifyMessage = 'Данные не сохранены';\n        this.notifyClass = 'wrapper-alert';\n        this.showNotify = true;\n        setTimeout(this.closeNotification, 1500);\n      });\n    },\n\n    closeNotification() {\n      this.showNotify = false;\n    },\n\n    updateFilterDataDirectory(filter_directory) {\n      this.filter_directory = filter_directory;\n    },\n\n    showModal() {\n      this.$refs['my-modal'].show();\n    },\n\n    hideModal() {\n      this.$refs['my-modal'].hide();\n    },\n\n    toggleModal() {\n      // We pass the ID of the button that we want to return focus to\n      // when the modal has hidden\n      this.$refs['my-modal'].toggle('#toggle-btn');\n    },\n\n    CreateCounterparties() {\n      this.loader = true;\n      apiReport.createCounterparties(data).then(response => {\n        this.loader = false;\n      });\n    }\n\n  },\n  computed: { ...mapState({\n      user: state => state.auth.user,\n      uid: state => state.auth.uid,\n      allGroups: state => state.auth.groups,\n      staffGlobal: state => state.auth.users\n    })\n  }\n};","map":{"version":3,"mappings":"AAgNA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA,oBADA;EAEAC;IAAAC;IAAAC;IAAAC;EAAA,CAFA;;EAGAC;IACA;MACAC,qBADA;MAEAC,cAFA;MAGAC,cAHA;MAIAC,kBAJA;MAKAC,aALA;MAMAC;QACAC;MADA,CANA;MASAF,aATA;MAUAG,iBAVA;MAWAC,UAXA;MAYAC,aAZA;MAaAC,cAbA;MAcAC,aAdA;MAeAC,OAfA;MAgBAC,QAhBA;MAiBAC,OAjBA;MAkBAC,OAlBA;MAmBAC,iBAnBA;MAoBAC,WApBA;MAqBAC,SArBA;MAsBAC,SAtBA;MAwBA;MACAC,iBAzBA;MA0BAC,cA1BA;MA2BAC,iBA3BA;MA4BAC,eA5BA;MA8BA7B;IA9BA;EAmCA,CAvCA;;EAwCA8B;IACAC;MACA;MACA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;;MACA;IACA,CAVA;;IAWAC;MACA;MACAC,gDACAC,IADA,CACAC;QACA;QACA;QACA;QAEA;QACA;QAEA;QACA;QACA;QACA;QACAC;QACA;MACA,CAfA,EAeAC,KAfA,CAeAC;QACA;QACA;QACA;QACA;QACA;QACAF;MACA,CAtBA;IAwBA,CArCA;;IAsCAG;MACA;MACAN,qCACAC,IADA,CACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACAC;MACA,CATA,EASAC,KATA,CASAC;QACA;QACA;QACA;QACA;QACA;QACAF;MACA,CAhBA;IAkBA,CA1DA;;IA2DAI;MACA;IACA,CA7DA;;IA8DAC;MACA;IACA,CAhEA;;IAiEAC;MACA;IACA,CAnEA;;IAoEAC;MACA;IACA,CAtEA;;IAuEAC;MACA;MACA;MACA;IACA,CA3EA;;IA4EAC;MACA;MACAC,qCACAZ,IADA,CACAC;QACA;MACA,CAHA;IAKA;;EAnFA,CAxCA;EA6HAY,YACA;MACAC,8BADA;MAEAC,4BAFA;MAGAC,qCAHA;MAIAC;IAJA;EADA;AA7HA","names":["name","components","Loader","filterDirectory","Notifications","data","groups","nextLink","prevLink","counterparties","loader","filter_directory","search","total_objects","amount","work_name","short_name","full_name","els","ogrn","inn","kpp","legal_address","manager","phone","group","showNotify","notifyHead","notifyMessage","notifyClass","methods","goToPage","getCounterparties","api","then","response","setTimeout","catch","err","savePartner","closeNotification","updateFilterDataDirectory","showModal","hideModal","toggleModal","CreateCounterparties","apiReport","computed","user","uid","allGroups","staffGlobal"],"sourceRoot":"src/components/Table","sources":["PartnerTable.vue"],"sourcesContent":["<template>\r\n\r\n    <div>\r\n        <Notifications :show=\"showNotify\" :header=\"notifyHead\" :message=\"notifyMessage\" :block-class=\"notifyClass\"\r\n            id=\"notif\" />\r\n        <Loader :loader=\"loader\"></Loader>\r\n        <filterDirectory @updateFilterDataDirectory=\"updateFilterDataDirectory\"></filterDirectory>\r\n\r\n        <div>\r\n            <b-modal ref=\"my-modal\" hide-footer title=\"Добавление контрагента\" id=\"modal-xl\" size=\"xl\">\r\n                <div class=\"d-block text-center\">\r\n                    <div\r\n                        style=\"width: 100%; height: 50vh; overflow-x: auto;overflow-y: auto; position: relative; left: 50%; transform: translate(-50%,0); margin-bottom: 3%;\">\r\n                        <table class=\"table\" style=\"table-layout: fixed;\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Рабочее наименование</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Кратное наименование</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Полное наименование</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        ЕЛС</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        ОГРН/ЕГРПОУ/БИН</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        ИНН/РНН</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        КПП/№ Св-ва НДС</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Юридический адрес</th>\r\n\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Руководитель</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Телефон</th>\r\n                                    <th\r\n                                        style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                                        Группа</th>\r\n\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n\r\n                                <tr>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"work_name\"></td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"short_name\">\r\n                                    </td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"full_name\"></td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"els\">\r\n                                    </td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"ogrn\">\r\n                                    </td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"inn\">\r\n                                    </td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"kpp\">\r\n                                    </td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"legal_address\">\r\n                                    </td>\r\n\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"manager\"></td>\r\n                                    <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"phone\"></td>\r\n\r\n                                    <td class=\"td-btr\">\r\n\r\n                                        <select v-model=\"group\" class=\"input-filter\">\r\n                                            <!-- <option value=\"all\">Все</option> -->\r\n                                            <option :value=\"g[0]\" v-for=\"g in Object.entries(groups)\" :key=\"g[0]\">{{\r\n                                                    g[1]\r\n                                            }}\r\n                                            </option>\r\n                                        </select>\r\n                                    </td>\r\n\r\n\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n                <b-button class=\"mt-3\" variant=\"outline-danger\" block @click=\"hideModal\">Закрыть</b-button>\r\n                <b-button class=\"mt-2\" variant=\"outline-danger\" block @click=\"CreateCounterparties()\">Сохранить\r\n                </b-button>\r\n            </b-modal>\r\n        </div>\r\n\r\n        <button class=\"Accept\" @click=\"getCounterparties()\"\r\n            style=\"width: 100%; position: relative; left: 50%; transform: translate(-50%,0)\">Запросить\r\n            контрагентов</button>\r\n        <br><br>\r\n\r\n        <p class=\"amount\">всего записей: {{ total_objects }}</p>\r\n        <p class=\"amount\">всего на странице: {{ amount }}</p>\r\n\r\n\r\n        <button class=\"Cancel\" style=\"border-top-left-radius: 10px; border-top-right-radius: 10px;\"\r\n            @click=\"showModal\">Добавить\r\n            контрагента</button>\r\n\r\n        <div\r\n            style=\"width: 100%; overflow-x: auto; height: 80vh; overflow-y: auto; position: relative; left: 50%; transform: translate(-50%,0); margin-bottom: 3%;\">\r\n            <table class=\"table\" style=\"table-layout: fixed;\">\r\n                <thead>\r\n                    <tr>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Рабочее наименование</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Кратное наименование</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Полное наименование</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            ЕЛС</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            ОГРН/ЕГРПОУ/БИН</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            ИНН/РНН</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            КПП/№ Св-ва НДС</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Юридический адрес</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Дата создания</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Руководитель</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Телефон</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Группа</th>\r\n                        <th\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            Действие</th>\r\n\r\n\r\n\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr v-for=\"(part, index) in counterparties\" :key=\"part.id\">\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].work_name\"></td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].short_name\"></td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].full_name\"></td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"counterparties[index].els\">\r\n                        </td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"counterparties[index].ogrn\">\r\n                        </td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"counterparties[index].inn\">\r\n                        </td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\" v-model=\"counterparties[index].kpp\">\r\n                        </td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].legal_address\"></td>\r\n                        <td class=\"td-btr\">{{ new Date(part.created_at).toLocaleString() }}</td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].manager\"></td>\r\n                        <td class=\"td-btr\"><input class=\"input-filter\" type=\"text\"\r\n                                v-model=\"counterparties[index].phone\"></td>\r\n                        <td class=\"td-btr\">\r\n\r\n                            <select v-model=\"counterparties[index].group\" class=\"input-filter\">\r\n                                <option value=\"all\">Все</option>\r\n                                <option :value=\"g[0]\" v-for=\"g in Object.entries(groups)\" :key=\"g[0]\">{{ g[1] }}\r\n                                </option>\r\n                            </select>\r\n                        </td>\r\n                        <td\r\n                            style=\"width:  200px !important; height: 50px !important; vertical-align: middle !important;\">\r\n                            <button class=\"Accept\" @click=\"savePartner(part)\">Сохранить</button>\r\n                        </td>\r\n\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n        <div style=\"display: flex; justify-content: space-around; margin-top: 2%;\">\r\n            <button class=\"Cancel\" style=\"width: 20%\" v-if=\"prevLink\" @click=\"goToPage(prevLink)\">назад</button>\r\n            <button class=\"Cancel\" style=\"width: 20%\" v-if=\"nextLink\" @click=\"goToPage(nextLink)\">вперед</button>\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport api from '@/api/directory'\r\nimport apiReport from '@/api/report'\r\nimport { mapState } from 'vuex';\r\nimport Loader from '@/components/loader/loader.vue'\r\nimport filterDirectory from '@/components/filter/FilterDirectory.vue'\r\nimport groups from '@/helpers/groups'\r\nimport Notifications from '@/components/notifications/Notifications.vue'\r\n\r\nexport default {\r\n    name: 'PartnerTable',\r\n    components: { Loader, filterDirectory, Notifications },\r\n    data() {\r\n        return {\r\n            groups: groups.groups,\r\n            nextLink: null,\r\n            prevLink: null,\r\n            counterparties: [],\r\n            loader: false,\r\n            filter_directory: {\r\n                search: '',\r\n            },\r\n            loader: false,\r\n            total_objects: '',\r\n            amount: '',\r\n            work_name: '',\r\n            short_name: '',\r\n            full_name: '',\r\n            els: '',\r\n            ogrn: '',\r\n            inn: '',\r\n            kpp: '',\r\n            legal_address: '',\r\n            manager: '',\r\n            phone: '',\r\n            group: '',\r\n\r\n            // Уведомления\r\n            showNotify: false,\r\n            notifyHead: '',\r\n            notifyMessage: '',\r\n            notifyClass: '',\r\n\r\n            name: ''\r\n\r\n\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        goToPage(link) {\r\n            let url = new URL(link)\r\n            let pageNumber = url.searchParams.get(\"page\")\r\n            if (pageNumber != null) {\r\n                this.filter_directory.page = pageNumber\r\n            } else {\r\n                delete (this.filter_directory.page)\r\n            }\r\n            this.getCounterparties()\r\n        },\r\n        getCounterparties() {\r\n            this.loader = true\r\n            api.getAllcounterparties(this.filter_directory)\r\n                .then(response => {\r\n                    this.counterparties = response.data.data\r\n                    this.nextLink = response.data.links.next\r\n                    this.prevLink = response.data.links.previous\r\n\r\n                    this.total_objects = response.data.total_objects\r\n                    this.amount = response.data.amount\r\n\r\n                    this.notifyHead = 'Успешно'\r\n                    this.notifyMessage = 'Данные отфильтрованы'\r\n                    this.notifyClass = 'wrapper-success'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                    this.loader = false\r\n                }).catch((err) => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Данные не отфильтрованы, попробуйте еще раз'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                })\r\n\r\n        },\r\n        savePartner(part) {\r\n            this.loader = true\r\n            api.putCounterparties(part.id, part)\r\n                .then(response => {\r\n                    // console.log(response)\r\n                    this.loader = false\r\n                    this.notifyHead = 'Успешно'\r\n                    this.notifyMessage = 'Данные о контрагенте сохранены'\r\n                    this.notifyClass = 'wrapper-success'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                }).catch((err => {\r\n                    this.loader = false\r\n                    this.notifyHead = 'Ошибка'\r\n                    this.notifyMessage = 'Данные не сохранены'\r\n                    this.notifyClass = 'wrapper-alert'\r\n                    this.showNotify = true\r\n                    setTimeout(this.closeNotification, 1500)\r\n                }))\r\n\r\n        },\r\n        closeNotification() {\r\n            this.showNotify = false\r\n        },\r\n        updateFilterDataDirectory(filter_directory) {\r\n            this.filter_directory = filter_directory\r\n        },\r\n        showModal() {\r\n            this.$refs['my-modal'].show()\r\n        },\r\n        hideModal() {\r\n            this.$refs['my-modal'].hide()\r\n        },\r\n        toggleModal() {\r\n            // We pass the ID of the button that we want to return focus to\r\n            // when the modal has hidden\r\n            this.$refs['my-modal'].toggle('#toggle-btn')\r\n        },\r\n        CreateCounterparties() {\r\n            this.loader = true\r\n            apiReport.createCounterparties(data)\r\n                .then(response => {\r\n                    this.loader = false\r\n                })\r\n\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapState({\r\n            user: state => state.auth.user,\r\n            uid: state => state.auth.uid,\r\n            allGroups: state => state.auth.groups,\r\n            staffGlobal: state => state.auth.users\r\n        })\r\n    },\r\n}\r\n</script>\r\n\r\n\r\n<style>\r\n.input-filter {\r\n    width: 100% !important;\r\n    height: 100% !important;\r\n    margin: 0 !important;\r\n    border: none;\r\n    text-decoration: none;\r\n    outline: none;\r\n    text-align: center;\r\n    font-size: 13px;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n\r\n"]},"metadata":{},"sourceType":"module"}